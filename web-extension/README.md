# 视频字幕生成器浏览器扩展

这是一个浏览器扩展，可以为网页上的视频自动生成字幕。它与 Whisper Web 后端服务配合使用，提供高质量的语音转文字功能。

## 功能

- 自动检测网页中的视频元素
- 智能选择主要视频（当页面有多个视频时）
- 从视频网站提取音频
- 使用 Whisper 模型生成高质量字幕
- 支持多种语言
- 支持 VTT、SRT 和 JSON 格式的字幕
- 实时将字幕添加到正在播放的视频中
- 优雅的加载状态显示

## 项目结构

```
web-extension/
├── src/
│   ├── popup.html        # 扩展弹出窗口界面
│   ├── popup.js         # 弹出窗口逻辑
│   ├── content.js       # 内容脚本（处理页面视频）
│   └── background.js    # 后台脚本（处理API请求）
├── public/              # 静态资源
└── manifest.json        # 扩展配置文件
```

## 安装

### 开发模式安装

1. 克隆或下载此仓库
2. 在 Chrome 浏览器中打开 `chrome://extensions/`
3. 启用"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `web-extension` 目录

### 后端服务

此扩展需要配合 Whisper Web 后端服务使用。请确保后端服务已正确安装并运行：

```bash
cd server
pip install -r requirements.txt
python run.py
```

默认情况下，后端服务运行在 `http://localhost:8000`。

## 使用方法

1. 访问包含视频的网页（如 YouTube、Bilibili 等）
2. 点击浏览器工具栏中的扩展图标
3. 在弹出窗口中点击"为当前视频生成字幕"按钮
4. 等待音频提取和转录完成
5. 字幕将自动添加到视频中并显示

## 工作流程

1. 检测页面中的视频元素
2. 如果存在多个视频，自动选择最大的视频元素
3. 提取视频音频
4. 发送到后端服务进行转录
5. 接收字幕文件
6. 创建字幕轨道并添加到视频
7. 自动显示字幕

## 设置

在扩展弹出窗口中，您可以配置以下设置：

- **字幕语言**：选择字幕的语言，或使用自动检测
- **字幕格式**：选择 VTT、SRT 或 JSON 格式
- **服务器地址**：设置后端服务的 URL（默认为 http://localhost:8000）

## 技术细节

- 使用 Chrome 扩展 Manifest V3
- 通过 content script 与网页交互
- 使用 background service worker 处理 API 请求
- 通过 WebVTT 标准将字幕添加到视频
- 支持动态创建和管理字幕轨道
- 自动清理临时资源

## 注意事项

- 此扩展需要访问网页内容和当前 URL
- 音频提取和转录过程可能需要一些时间，取决于视频长度和服务器性能
- 某些网站可能限制内容访问，导致音频提取失败
- 确保浏览器允许扩展访问所需权限
- 建议使用支持CUDA的后端服务以获得更好的性能

## 许可证

MIT 